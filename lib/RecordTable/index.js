var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var a,r=1,o=arguments.length;r<o;r++)for(var s in a=arguments[r])Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,a){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,s,t=r.call(e),l=[];try{for(;(void 0===a||0<a--)&&!(o=t.next()).done;)l.push(o.value)}catch(e){s={error:e}}finally{try{o&&!o.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return l};import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";import{Box,TableContainer,Table,CircularProgress}from"@mui/material";import React from"react";import RecordTableHeader from"./Header";import RecordTableBody from"./Body";import RecordTableFooter from"./Footer";import{getDataDisplay,getContainerSizeByScroll,getRenderColumns,getDataColumns}from"./helper";import classNames from"classnames";import styles from"./index.module.css";import useExpanded from"./useExpanded";import useSorted from"./useSorted";import useSelected from"./useSelected";import usePagination from"./usePagination";import useFiltered from"./useFiltered";import useScroll from"./useScroll";var MRTableContext=React.createContext(null),RecordTable=function(e){var a=e.bordered,r=e.className,r=void 0===r?"":r,o=e.columns,s=e.dataSource,t=e.component,t=void 0===t?Box:t,l=e.expandable,n=e.loading,i=e.pagination,c=e.rowClassName,c=void 0===c?"":c,d=e.rowKey,m=e.rowSelection,u=e.size,u=void 0===u?"medium":u,g=e.sticky,g=void 0!==g&&g,p=e.sortInfo,f=(e.onChange,e.scroll),x=e.dropable,y=e.filterInfo,e=e.sx,e=void 0===e?{}:e,b=getDataColumns(o),o=getRenderColumns(o),_=__read(React.useState([]),2),S=_[0],h=_[1],_=useScroll(),C=_.containerRef,_=_.scrollingInfo,P=useSelected({data:S,rowKey:d,rowSelection:m}),R=P.selectRowKeys,w=P.onSelectAll,P=P.onSelectChange,v=usePagination({dataSource:s,pagination:i,onSelectAll:w}),j=v.pageParams,T=v.onPaginationChange,v=v.setPageParams,s=useFiltered({dataSource:s,pageParams:j,filterInfo:y,setPageParams:v,onPaginationChange:T}),N=s.filteredData,v=s.filterParams,s=s.onFilterChange,K=useSorted({sortInfo:p,pageParams:j,onPaginationChange:T}),B=K.sortParams,K=K.onSortChange,I=useExpanded({data:S,rowKey:d,expandable:l}),k=I.expandedRowKeys,I=I.onExpandChange,F=(React.useEffect(function(){var e=getDataDisplay(N,i,j,B);h(e)},[N,j,B,i]),null!=f&&f.x&&(e=Object.assign({},e,{width:"".concat(null==f?void 0:f.x,"px")})),g||!(null==f||!f.y)),D=classNames(((D={})[styles["mr-table-wrpper"]]=!0,D[styles["mr-table-wrpper-scroll"]]=F,D)),E=classNames(((E={})[styles["mr-table-container"]]=!0,E[styles["mr-table-container-scroll-x"]]=!(null==f||!f.x),E[styles["mr-table-container-scroll-y"]]=F,E[styles["mr-table-container-scroll-top"]]=!_.scrollTop,E)),a=classNames(r,((r={})[styles["mr-table"]]=!0,r[styles["mr-table-bordered"]]=a,r[styles["mr-table-fixed"]]=!(null==f||!f.x),r)),r=classNames(styles["mr-table-loading-mask"],((r={})[styles.hide]=!n,r));return _jsx(MRTableContext.Provider,__assign({value:{expandable:l,rowSelection:m,sortInfo:p,filterInfo:y,dropable:x,scroll:f,rowClassName:c}},{children:_jsxs(Box,__assign({className:D},{children:[_jsx(TableContainer,__assign({ref:C,component:t,className:E,sx:getContainerSizeByScroll(f)},{children:_jsxs(Table,__assign({size:u,stickyHeader:g||!(null==f||!f.y),sx:e,className:a},{children:[_jsx(RecordTableHeader,{columns:b,renderColumns:o,onSortChange:K,sortParams:B,selectRowKeys:R,dataSource:S,pageParams:j,onSelectAll:w,rowKey:d,isSticky:F,onFilterChange:s,filterParams:v,scrollingInfo:_}),_jsx(RecordTableBody,{rowKey:d,columns:b,dataSource:S,selectRowKeys:R,onSelectChange:P,expandedRowKeys:k,onExpandChange:I,pageParams:j,scrollingInfo:_})]}))})),_jsx(RecordTableFooter,{pageParams:j,pagination:i,onPaginationChange:T}),_jsx(Box,__assign({className:r},{children:_jsx(CircularProgress,__assign({},n||{}))}))]}))}))};export default RecordTable;export{MRTableContext};