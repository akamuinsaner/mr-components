var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var a,l=1,r=arguments.length;l<r;l++)for(var t in a=arguments[l])Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,a){var l="function"==typeof Symbol&&e[Symbol.iterator];if(!l)return e;var r,t,n=l.call(e),o=[];try{for(;(void 0===a||0<a--)&&!(r=n.next()).done;)o.push(r.value)}catch(e){t={error:e}}finally{try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(t)throw t.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,a,l){if(l||2===arguments.length)for(var r,t=0,n=a.length;t<n;t++)!r&&t in a||((r=r||Array.prototype.slice.call(a,0,t))[t]=a[t]);return e.concat(r||Array.prototype.slice.call(a))};import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";import{Box,TableContainer,Table,CircularProgress}from"@mui/material";import React from"react";import RecordTableHeader from"./Header";import RecordTableBody from"./Body";import RecordTableFooter from"./Footer";import{getRowKey,getDataDisplay,getContainerSizeByScroll,getRenderColumns,getDataColumns,getFilteredData}from"./helper";import classNames from"classnames";import styles from"../index.module.css";var MRTableContext=React.createContext(null),RecordTable=function(e){function t(l){return w.filter(function(e,a){return l.includes(getRowKey(e,f,a))})}function a(){clearTimeout(void 0),setTimeout(function(){var e=C.current,a=e.scrollTop,l=e.scrollWidth,r=e.scrollLeft,e=e.clientWidth;k({scrollTop:0===a,scrollLeft:0===r,scrollRight:l===r+e})},300)}function l(e,a){E(__assign(__assign({},j),{page:e,rowsPerPage:a})),A([],[])}var O=e.bordered,r=e.className,r=void 0===r?"":r,n=e.columns,o=e.dataSource,s=e.component,s=void 0===s?Box:s,i=e.expandable,c=e.loading,u=e.pagination,d=e.rowClassName,d=void 0===d?"":d,f=e.rowKey,g=e.rowSelection,m=e.size,m=void 0===m?"medium":m,_=e.sticky,_=void 0!==_&&_,p=e.sortInfo,y=(e.onChange,e.scroll),R=e.dropable,x=e.filterInfo,e=e.sx,e=void 0===e?{}:e,h=getDataColumns(n),n=getRenderColumns(n),v=__read(React.useState([]),2),b=v[0],I=v[1],v=__read(React.useState([]),2),w=v[0],L=v[1],C=React.useRef(null),v=__read(React.useState({scrollTop:!1,scrollLeft:!1,scrollRight:!1}),2),P=v[0],k=v[1],v=(React.useEffect(function(){return a(),C.current.addEventListener("scroll",a),function(){return C.current.removeEventListener("scroll",a)}},[]),__read(React.useState(Object.assign({},null==x?void 0:x.defaultFilterParams)),2)),S=v[0],K=v[1],T=(React.useEffect(function(){null!=x&&x.filterParams&&K(null==x?void 0:x.filterParams)},[null==x?void 0:x.filterParams]),React.useEffect(function(){var e=getFilteredData(o,S);I(e),E(__assign(__assign({},j),{page:0,count:e.length}))},[o,S]),{count:o.length,page:0,rowsPerPage:!1===u?o.length:10}),v=__read(React.useState(Object.assign({},T,u)),2),j=v[0],E=v[1],v=(React.useEffect(function(){var e,a,l;u&&(e=u.page,a=u.count,l=u.rowsPerPage,E(__assign(__assign({},T),{page:e,count:a,rowsPerPage:l})))},[u]),__read(React.useState(Object.assign({},{orderBy:"",order:null},null==p?void 0:p.defaultSortParams)),2)),N=v[0],B=v[1],v=(React.useEffect(function(){null!=p&&p.sortParams&&B(null==p?void 0:p.sortParams)},[null==p?void 0:p.sortParams]),__read(React.useState((null==g?void 0:g.defaultSelectedRowKeys)||[]),2)),z=v[0],F=v[1],A=function(e,a){null!=g&&g.selectedRowKeys||F(e),null!=g&&g.onChange&&null!=g&&g.onChange(e,a)},v=(React.useEffect(function(){null!=g&&g.selectedRowKeys&&F(null==g?void 0:g.selectedRowKeys)},[null==g?void 0:g.selectedRowKeys]),__read(React.useState(null!=i&&i.defaultExpandedRowKeys?null==i?void 0:i.defaultExpandedRowKeys:null!=i&&i.defaultExpandAllRows?w.map(function(e,a){return getRowKey(e,f,a)}):[]),2)),D=v[0],H=v[1],v=(React.useEffect(function(){null!=i&&i.expandedRowKeys&&H(null==i?void 0:i.expandedRowKeys)},[null==i?void 0:i.expandedRowKeys]),React.useEffect(function(){var e=getDataDisplay(b,u,j,N);L(e)},[b,j,N,u]),null!=y&&y.x&&(e=Object.assign({},e,{width:"".concat(null==y?void 0:y.x,"px")})),_||!(null==y||!y.y));return _jsx(MRTableContext.Provider,__assign({value:{expandable:i,rowSelection:g,sortInfo:p,filterInfo:x,dropable:R,scroll:y,rowClassName:d}},{children:_jsxs(Box,__assign({className:classNames(((R={})[styles["mr-table-wrpper"]]=!0,R[styles["mr-table-wrpper-scroll"]]=v,R))},{children:[_jsx(TableContainer,__assign({ref:C,component:s,className:classNames(((d={})[styles["mr-table-container"]]=!0,d[styles["mr-table-container-scroll-x"]]=!(null==y||!y.x),d[styles["mr-table-container-scroll-y"]]=v,d[styles["mr-table-container-scroll-top"]]=!P.scrollTop,d)),sx:getContainerSizeByScroll(y)},{children:_jsxs(Table,__assign({size:m,stickyHeader:_||!(null==y||!y.y),sx:e,className:classNames(r,((R={})[styles["mr-table"]]=!0,R[styles["mr-table-bordered"]]=O,R[styles["mr-table-fixed"]]=!(null==y||!y.x),R))},{children:[_jsx(RecordTableHeader,{columns:h,renderColumns:n,onSortChange:function(e,a){a={order:a,orderBy:e};l(0,j.rowsPerPage),A([],[]),null!=p&&p.sortParams||B(a),null!=p&&p.onSortChange&&p.onSortChange(a)},sortParams:N,selectRowKeys:z,dataSource:w,pageParams:j,onSelectAll:A,rowKey:f,isSticky:v,onFilterChange:function(e){l(0,j.rowsPerPage);e=__assign(__assign({},S),e);null!=x&&x.filterParams||K(e),null!=x&&x.onFilterChange&&x.onFilterChange(e)},filterParams:S,scrollingInfo:P}),_jsx(RecordTableBody,{rowKey:f,columns:h,dataSource:w,selectRowKeys:z,onSelectChange:function(e,a,l,r){null!=g&&g.selectedRowKeys||F(e),null!=g&&g.onChange&&null!=g&&g.onChange(e,t(e)),null!=g&&g.onSelect&&r&&null!=g&&g.onSelect(r,l)},expandedRowKeys:D,onExpandChange:function(a,e,l){var r=[],r=e?__spreadArray(__spreadArray([],__read(D),!1),[a],!1):D.filter(function(e){return e!==a});null!=i&&i.onExpandedRowsChange&&null!=i&&i.onExpandedRowsChange(r,t(r)),null!=i&&i.expandedRowKeys||H(r),null!=i&&i.onExpand&&e&&null!=i&&i.onExpand(l)},pageParams:j,scrollingInfo:P})]}))})),_jsx(RecordTableFooter,{pageParams:j,pagination:u,onPaginationChange:l}),_jsx(Box,__assign({className:classNames(styles["mr-table-loading-mask"],((s={})[styles.hide]=!c,s))},{children:_jsx(CircularProgress,__assign({},c||{}))}))]}))}))};export default RecordTable;export{MRTableContext};