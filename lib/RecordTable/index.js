var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var a,n=1,r=arguments.length;n<r;n++)for(var l in a=arguments[n])Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,a){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,l,t=n.call(e),o=[];try{for(;(void 0===a||0<a--)&&!(r=t.next()).done;)o.push(r.value)}catch(e){l={error:e}}finally{try{r&&!r.done&&(n=t.return)&&n.call(t)}finally{if(l)throw l.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,a,n){if(n||2===arguments.length)for(var r,l=0,t=a.length;l<t;l++)!r&&l in a||((r=r||Array.prototype.slice.call(a,0,l))[l]=a[l]);return e.concat(r||Array.prototype.slice.call(a))};import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";import{Box,TableContainer,Table}from"@mui/material";import React from"react";import RecordTableHeader from"./Header";import RecordTableBody from"./Body";import RecordTableFooter from"./Footer";import{getRowKey,getDataDisplay,getContainerSizeByScroll,getRenderColumns,getDataColumns}from"./helper";import classNames from"classnames";import styles from"../index.module.css";var MRTableContext=React.createContext(null),RecordTable=function(e){function l(n){return h.filter(function(e,a){return n.includes(getRowKey(e,d,a))})}function n(e,a){K(__assign(__assign({},S),{page:e,rowsPerPage:a})),N([],[])}var a=e.bordered,r=e.className,r=void 0===r?"":r,t=e.columns,o=e.dataSource,s=e.component,s=void 0===s?Box:s,i=e.expandable,c=e.pagination,u=e.rowClassName,u=void 0===u?"":u,d=e.rowKey,f=e.rowSelection,m=e.size,m=void 0===m?"medium":m,g=e.sticky,g=void 0!==g&&g,p=e.sortInfo,y=(e.onChange,e.scroll),_=e.dropable,x=e.filterInfo,e=e.sx,e=void 0===e?{}:e,R=getDataColumns(t),t=getRenderColumns(t),w=__read(React.useState([]),2),h=w[0],b=w[1],w=__read(React.useState(Object.assign({},null==x?void 0:x.defaultFilterParams)),2),v=w[0],C=w[1],P=(React.useEffect(function(){null!=x&&x.filterParams&&C(null==x?void 0:x.filterParams)},[null==x?void 0:x.filterParams]),{count:o.length,page:0,rowsPerPage:!1===c?o.length:10}),w=__read(React.useState(Object.assign({},P,c)),2),S=w[0],K=w[1],w=(React.useEffect(function(){var e,a,n;c&&(e=c.page,a=c.count,n=c.rowsPerPage,K(__assign(__assign({},P),{page:e,count:a,rowsPerPage:n})))},[c]),__read(React.useState(Object.assign({},{orderBy:"",order:null},null==p?void 0:p.defaultSortParams)),2)),j=w[0],T=w[1],w=(React.useEffect(function(){null!=p&&p.sortParams&&T(null==p?void 0:p.sortParams)},[null==p?void 0:p.sortParams]),__read(React.useState((null==f?void 0:f.defaultSelectedRowKeys)||[]),2)),E=w[0],B=w[1],N=function(e,a){null!=f&&f.selectedRowKeys||B(e),null!=f&&f.onChange&&null!=f&&f.onChange(e,a)},w=(React.useEffect(function(){null!=f&&f.selectedRowKeys&&B(null==f?void 0:f.selectedRowKeys)},[null==f?void 0:f.selectedRowKeys]),__read(React.useState(null!=i&&i.defaultExpandedRowKeys?null==i?void 0:i.defaultExpandedRowKeys:null!=i&&i.defaultExpandAllRows?h.map(function(e,a){return getRowKey(e,d,a)}):[]),2)),A=w[0],F=w[1],w=(React.useEffect(function(){null!=i&&i.expandedRowKeys&&F(null==i?void 0:i.expandedRowKeys)},[null==i?void 0:i.expandedRowKeys]),React.useEffect(function(){b(getDataDisplay(o,c,S,j,v))},[o,S,j,v,c]),null!=y&&y.x&&(e=Object.assign({},e,{width:"".concat(null==y?void 0:y.x,"px")})),g||!(null==y||!y.y));return _jsx(MRTableContext.Provider,__assign({value:{expandable:i,rowSelection:f,sortInfo:p,filterInfo:x,dropable:_,rowClassName:u}},{children:_jsxs(Box,__assign({className:classNames(((_={})[styles["mr-table-wrpper"]]=!0,_[styles["mr-table-wrpper-scroll"]]=w,_))},{children:[_jsx(TableContainer,__assign({component:s,className:classNames(((u={})[styles["mr-table-container"]]=!0,u[styles["mr-table-container-scroll-x"]]=!(null==y||!y.x),u[styles["mr-table-container-scroll-y"]]=w,u)),sx:getContainerSizeByScroll(y)},{children:_jsxs(Table,__assign({size:m,stickyHeader:g||!(null==y||!y.y),sx:e,className:classNames(r,((_={})[styles["mr-table"]]=!0,_[styles["mr-table-bordered"]]=a,_[styles["mr-table-fixed"]]=!(null==y||!y.x),_))},{children:[_jsx(RecordTableHeader,{columns:R,renderColumns:t,onSortChange:function(e,a){a={order:a,orderBy:e};n(0,S.rowsPerPage),N([],[]),null!=p&&p.sortParams||T(a),null!=p&&p.onSortChange&&p.onSortChange(a)},sortParams:j,selectRowKeys:E,dataSource:h,pageParams:S,onSelectAll:N,rowKey:d,isSticky:w,onFilterChange:function(e){n(0,S.rowsPerPage);e=__assign(__assign({},v),e);null!=x&&x.filterParams||C(e),null!=x&&x.onFilterChange&&x.onFilterChange(e)},filterParams:v}),_jsx(RecordTableBody,{rowKey:d,columns:R,dataSource:h,selectRowKeys:E,onSelectChange:function(e,a,n,r){null!=f&&f.selectedRowKeys||B(e),null!=f&&f.onChange&&null!=f&&f.onChange(e,l(e)),null!=f&&f.onSelect&&r&&null!=f&&f.onSelect(r,n)},expandedRowKeys:A,onExpandChange:function(a,e,n){var r=[],r=e?__spreadArray(__spreadArray([],__read(A),!1),[a],!1):A.filter(function(e){return e!==a});null!=i&&i.onExpandedRowsChange&&null!=i&&i.onExpandedRowsChange(r,l(r)),null!=i&&i.expandedRowKeys||F(r),null!=i&&i.onExpand&&e&&null!=i&&i.onExpand(n)},pageParams:S})]}))})),_jsx(RecordTableFooter,{pageParams:S,pagination:c,onPaginationChange:n})]}))}))};export default RecordTable;export{MRTableContext};