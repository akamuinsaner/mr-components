var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var r={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(r[a[o]]=e[a[o]]);return r},__read=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,a,n=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(o=n.next()).done;)i.push(o.value)}catch(e){a={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var o,a=0,n=t.length;a<n;a++)!o&&a in t||((o=o||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))};import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from"react/jsx-runtime";import React from"react";import TextField from"@mui/material/TextField";import Autocomplete from"@mui/material/Autocomplete";import CancelIcon from"@mui/icons-material/Cancel";import ArrowDropDownIcon from"@mui/icons-material/ArrowDropDown";import Chip from"@mui/material/Chip";import Tag from"../TreeSelect/Tag";import getTreeDataFormatted from"../utils/getTreeDataFormatted";import DropDown from"./DropDown";import Options from"./Options";import useTagLimits from"./useTagLimits";import useAnchor from"./useAnchor";import useSearch from"./useSearch";import useValue from"./useValue";import useLoadData from"./useLoadData";import useOpen from"./useOpen";var Cascader=function(e){function t(){return j([])}function r(){var e;return i?D:!!S&&a?b:(null==(e=y.get(D[0]))?void 0:e.name)||""}var o=e.search,a=void 0!==o&&o,n=e.options,o=e.multiple,i=void 0!==o&&o,o=e.checkable,l=void 0!==o&&o,s=e.checkWithRelation,o=e.popperStyle,p=void 0===o?{}:o,c=e.popperClassName,o=e.value,u=e.onChange,m=e.loadData,d=e.allowClear,d=void 0!==d&&d,f=e.maxTagCount,h=void 0===f?0:f,g=__rest(e,["search","options","multiple","checkable","checkWithRelation","popperStyle","popperClassName","value","onChange","loadData","allowClear","maxTagCount"]),_=React.useRef(!1),f=__read(React.useState(getTreeDataFormatted(n)),2),C=f[0],v=f[1],y=(C.flattedData,C.idTreeNodeMap),e=(React.useEffect(function(){_.current?v(getTreeDataFormatted(n)):_.current=!0},[n]),useValue({value:o,multiple:i,onChange:u,dataSet:C,checkWithRelation:s})),D=e.selected,x=e.onOptionSelect,j=e.onValueChange,w=e.toggleCheck,f=useOpen(),o=f.openKeys,O=f.openChildren,u=useSearch({search:a,multiple:i,dataSet:C}),T=u.searchData,b=u.inputValue,e=u.onInputChange,f=useAnchor({onInputChange:e}),S=f.anchorEl,A=f.inputRef,u=f.eleRef,I=f.openDropDown,k=f.hovering,R=f.setHovering,f=useTagLimits({maxTagCount:h,selected:D,inputRef:A}),F=f.tagLimit,L=f.tagWidths,W=f.setTagWidths,f=useLoadData({loadData:m,openChildren:O}),P=f.loadingId,V=f.startLoadData;return _jsxs(_Fragment,{children:[_jsx(Autocomplete,{ref:u,options:[],open:!1,readOnly:!(a&&S),multiple:i,disabled:g.disabled,disableClearable:!0,value:r(),onFocus:I,inputValue:b,onClick:function(e){return e.stopPropagation()},onInputChange:e,onMouseEnter:function(e){return R(!0)},onMouseLeave:function(e){return R(!1)},popupIcon:k&&D.length&&d?_jsx(CancelIcon,{onClick:t}):_jsx(ArrowDropDownIcon,{onClick:I}),renderInput:function(e){var t=!!S;return _jsx(TextField,__assign({},e,g,{ref:A,onClick:function(e){return e.stopPropagation()},focused:t,placeholder:t&&!i?r():g.placeholder,sx:{"& .MuiAutocomplete-inputRoot":{flexWrap:"responsive"===h?"nowrap":"wrap"}}}))},renderTags:function(e,t){var r=e.slice(0,F),e=e.slice(F),o=g.size;return r.map(function(e,r){e=y.get(e);return _jsx(Tag,{size:o,onDelete:function(t){j(D.filter(function(e){return e!==t})),W(L.filter(function(e,t){return t!==r}))},option:e,onInit:function(e){var t=__spreadArray([],__read(L),!1);t[r]=e,W(t)}})}).concat(e.length?[_jsx(Chip,{size:o,label:"+".concat(e.length,"...")})]:[])}}),o.map(function(e,t){var r="small"===g.size;return _jsx(DropDown,__assign({depth:t,anchorEl:S,popperStyle:p,popperClassName:c},{children:_jsx(Options,{dense:r,parentId:e,showCheck:l&&i,multiple:i,selected:D,loadData:m,openChildren:O,dataSet:C,checkWithRelation:s,toggleCheck:w,searchData:T,onSelect:x,startLoadData:V,depth:t,loadingId:P})}),e)})]})};export default Cascader;