var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]]);return r},__read=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||((n=n||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from"react/jsx-runtime";import React from"react";import TextField from"@mui/material/TextField";import Autocomplete from"@mui/material/Autocomplete";import CancelIcon from"@mui/icons-material/Cancel";import ArrowDropDownIcon from"@mui/icons-material/ArrowDropDown";import Chip from"@mui/material/Chip";import Tag from"../TreeSelect/Tag";import{flatOptions,idAllChildrenMap}from"../TreeSelect/helper";import DropDown from"./DropDown";import Options from"./Options";var Cascader=function(e){function t(){for(var e=g.current.offsetWidth,t=0,r=0;r<x.length;){if(e-(t+=x[0])<150){E(r+1);break}r++}}function r(){return D([])}function n(e){e.stopPropagation(),I(""),R(C.current)}function o(e){I(""),R(null),document.removeEventListener("click",o)}function a(){var e;return c?A:!!O&&l?k:(null==(e=F.find(function(e){return e.id===A[0]}))?void 0:e.name)||""}var i=e.search,l=void 0!==i&&i,s=e.options,i=e.multiple,c=void 0!==i&&i,i=e.checkable,u=void 0!==i&&i,i=e.popperStyle,p=void 0===i?{}:i,f=e.popperClassName,i=e.value,d=e.onChange,_=e.loadData,m=e.allowClear,m=void 0!==m&&m,h=e.maxTagCount,v=void 0===h?0:h,y=__rest(e,["search","options","multiple","checkable","popperStyle","popperClassName","value","onChange","loadData","allowClear","maxTagCount"]),g=React.useRef(null),C=React.useRef(null),h=__read(React.useState([]),2),x=h[0],w=h[1],e=__read(React.useState(!1),2),b=e[0],j=e[1],h=__read(React.useState(null),2),O=h[0],R=h[1],e=__read(React.useState(!1),2),h=e[0],S=e[1],e=__read(React.useState(Array.isArray(i)?i:i?[i]:[]),2),A=e[0],D=e[1],i=__read(React.useState(1e4),2),T=i[0],E=i[1],e=__read(React.useState(""),2),k=e[0],I=e[1],i=__read(React.useState(flatOptions(s)),2),F=i[0],P=i[1],e=__read(React.useState(new Map),2),z=e[0],L=e[1],i=__read(React.useState([""]),2),M=i[0],N=i[1];React.useEffect(function(){L(idAllChildrenMap(s))},[F]),React.useEffect(function(){return"number"==typeof v&&E(v||1e4),"responsive"===v&&(E(1e4),t(),window.addEventListener("resize",t)),function(){window.removeEventListener("resize",t)}},[v,x,A]),React.useEffect(function(){b?d&&d(c?A:A[0]):j(!0)},[A]),React.useEffect(function(){O&&setTimeout(function(){document.addEventListener("click",o)},300)},[O]);return _jsxs(_Fragment,{children:[_jsx(Autocomplete,{ref:C,options:[],open:!1,readOnly:!(l&&O),multiple:c,disabled:y.disabled,disableClearable:!0,value:a(),onFocus:n,inputValue:k,onClick:function(e){return e.stopPropagation()},onInputChange:function(e,t,r){"reset"===r&&c||I(t)},onMouseEnter:function(e){return S(!0)},onMouseLeave:function(e){return S(!1)},popupIcon:h&&A.length&&m?_jsx(CancelIcon,{onClick:r}):_jsx(ArrowDropDownIcon,{onClick:n}),renderInput:function(e){var t=!!O;return _jsx(TextField,__assign({},e,y,{ref:g,onClick:function(e){return e.stopPropagation()},focused:t,placeholder:t&&!c?a():y.placeholder,sx:{"& .MuiAutocomplete-inputRoot":{flexWrap:"responsive"===v?"nowrap":"wrap"}}}))},renderTags:function(e,t){var r=e.slice(0,T),e=e.slice(T),n=y.size;return r.map(function(t,r){var e=F.find(function(e){return e.id===t});return _jsx(Tag,{size:n,onDelete:function(t){D(A.filter(function(e){return e!==t})),w(x.filter(function(e,t){return t!==r}))},option:e,onInit:function(e){var t=__spreadArray([],__read(x),!1);t[r]=e,w(t)}})}).concat(e.length?[_jsx(Chip,{size:n,label:"+".concat(e.length,"...")})]:[])}}),M.map(function(e,r){var t="small"===y.size;return _jsx(DropDown,__assign({depth:r,anchorEl:O,popperStyle:p,popperClassName:f},{children:_jsx(Options,{dense:t,parentId:e,showCheck:u&&c,search:l,multiple:c,selected:A,inputValue:k,flatOptions:F,setSelected:D,allChildrenMap:z,setFlattedOptions:P,loadData:_,openChildren:function(e){var t=__spreadArray([],__read(M),!1);t[r+1]=e,N(t)}})}),e)})]})};export default Cascader;