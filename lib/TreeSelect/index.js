var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]]);return r},__read=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||((n=n||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from"react/jsx-runtime";import React from"react";import TextField from"@mui/material/TextField";import ArrowDropDownIcon from"@mui/icons-material/ArrowDropDown";import{flatOptions,idAllChildrenMap}from"./helper";import Autocomplete from"@mui/material/Autocomplete";import CancelIcon from"@mui/icons-material/Cancel";import Chip from"@mui/material/Chip";import Tag from"./Tag";import DropDown from"./DropDown";import Options from"./Options";import useTagLimits from"./useTagLimits";var TreeSelect=function(e){function t(){return T([])}function r(e){e.stopPropagation(),I(""),b(C.current)}function n(e){I(""),b(null),document.removeEventListener("click",n)}function o(){var e;return s?S:!!O&&i?k:(null==(e=D.find(function(e){return e.id===S[0]}))?void 0:e.name)||""}var a=e.search,i=void 0!==a&&a,l=e.options,a=e.multiple,s=void 0!==a&&a,a=e.placement,a=void 0===a?"bottom-start":a,c=e.checkable,c=void 0!==c&&c,p=e.expandAll,p=void 0!==p&&p,u=e.popperStyle,u=void 0===u?{}:u,f=e.popperClassName,d=e.value,m=e.expandKeys,_=e.onChange,h=e.loadData,g=e.allowClear,g=void 0!==g&&g,v=e.maxTagCount,y=void 0===v?0:v,x=__rest(e,["search","options","multiple","placement","checkable","expandAll","popperStyle","popperClassName","value","expandKeys","onChange","loadData","allowClear","maxTagCount"]),C=React.useRef(null),v=React.useRef(null),e=__read(React.useState(!1),2),j=e[0],w=e[1],e=__read(React.useState(null),2),O=e[0],b=e[1],e=__read(React.useState(!1),2),A=e[0],R=e[1],e=__read(React.useState(Array.isArray(d)?d:d?[d]:[]),2),S=e[0],T=e[1],d=__read(React.useState(flatOptions(l)),2),D=d[0],e=d[1],d=__read(React.useState(new Map),2),M=d[0],P=d[1],d=__read(React.useState(""),2),k=d[0],I=d[1],d=(React.useEffect(function(){P(idAllChildrenMap(l))},[D]),useTagLimits({maxTagCount:y,selected:S,inputRef:C})),E=d.tagLimit,F=d.tagWidths,L=d.setTagWidths;React.useEffect(function(){j?_&&_(s?S:S[0]):w(!0)},[S]),React.useEffect(function(){O&&setTimeout(function(){document.addEventListener("click",n)},300)},[O]);return _jsxs(_Fragment,{children:[_jsx(Autocomplete,{ref:v,options:[],open:!1,disabled:x.disabled,onFocus:r,readOnly:!(i&&O),multiple:s,disableClearable:!0,value:o(),inputValue:k,onClick:function(e){return e.stopPropagation()},onInputChange:function(e,t,r){"reset"===r&&s||I(t)},onMouseEnter:function(e){return R(!0)},onMouseLeave:function(e){return R(!1)},popupIcon:A&&S.length&&g?_jsx(CancelIcon,{onClick:t}):_jsx(ArrowDropDownIcon,{onClick:r}),renderInput:function(e){var t=!!O;return _jsx(TextField,__assign({},e,x,{onClick:function(e){return e.stopPropagation()},focused:t,ref:C,placeholder:t&&!s?o():x.placeholder,sx:{"& .MuiAutocomplete-inputRoot":{flexWrap:"responsive"===y?"nowrap":"wrap"}}}))},renderTags:function(e,t){var r=e.slice(0,E),e=e.slice(E),n=x.size;return r.map(function(t,r){var e=D.find(function(e){return e.id===t});return _jsx(Tag,{size:n,onDelete:function(t){T(S.filter(function(e){return e!==t})),L(F.filter(function(e,t){return t!==r}))},option:e,onInit:function(e){var t=__spreadArray([],__read(F),!1);t[r]=e,L(t)}})}).concat(e.length?[_jsx(Chip,{size:n,label:"+".concat(e.length,"...")})]:[])}}),_jsx(DropDown,__assign({anchorEl:O,placement:a,popperStyle:u,popperClassName:f,initialWidth:null==(d=null==v?void 0:v.current)?void 0:d.offsetWidth},{children:_jsx(Options,{dense:"small"===x.size,expandAll:p,showCheck:s&&c,search:i,multiple:s,selected:S,inputValue:k,flatOptions:D,setSelected:T,allChildrenMap:M,setFlattedOptions:e,loadData:h,expandKeys:m})}))]})};export default TreeSelect;