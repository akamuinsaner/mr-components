var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,o=arguments.length;a<o;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var a={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(a[r[o]]=e[r[o]]);return a},__read=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var o,r,n=a.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(o=n.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(a=n.return)&&a.call(n)}finally{if(r)throw r.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var o,r=0,n=t.length;r<n;r++)!o&&r in t||((o=o||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from"react/jsx-runtime";import React from"react";import TextField from"@mui/material/TextField";import ArrowDropDownIcon from"@mui/icons-material/ArrowDropDown";import Autocomplete from"@mui/material/Autocomplete";import CancelIcon from"@mui/icons-material/Cancel";import Chip from"@mui/material/Chip";import Tag from"./Tag";import DropDown from"./DropDown";import Options from"./Options";import useTagLimits from"./useTagLimits";import getTreeDataFormatted from"../utils/getTreeDataFormatted";import useExpanded from"./useExpanded";import useLoadData from"./useLoadData";import useSearch from"./useSearch";import useAnchor from"./useAnchor";import useValue from"./useValue";var TreeSelect=function(e){function t(){return w([])}function a(){var e;return i?j:!!A&&r?b:(null==(e=T.get(j[0]))?void 0:e.name)||""}var o=e.search,r=void 0!==o&&o,n=e.options,o=e.multiple,i=void 0!==o&&o,o=e.placement,o=void 0===o?"bottom-start":o,l=e.checkable,l=void 0!==l&&l,s=e.checkWithRelation,p=e.defaultExpandAll,p=void 0!==p&&p,u=e.defaultExpandedKeys,c=e.popperStyle,c=void 0===c?{}:c,d=e.popperClassName,m=e.value,f=e.expandedKeys,h=e.onChange,g=e.onExpand,x=e.loadData,_=e.allowClear,_=void 0!==_&&_,y=e.maxTagCount,v=void 0===y?0:y,D=__rest(e,["search","options","multiple","placement","checkable","checkWithRelation","defaultExpandAll","defaultExpandedKeys","popperStyle","popperClassName","value","expandedKeys","onChange","onExpand","loadData","allowClear","maxTagCount"]),C=React.useRef(!1),y=__read(React.useState(getTreeDataFormatted(n)),2),e=y[0],W=y[1],y=e.flattedData,T=e.idTreeNodeMap,m=(React.useEffect(function(){C.current?W(getTreeDataFormatted(n)):C.current=!0},[n]),useValue({value:m,multiple:i,onChange:h,dataSet:e,checkWithRelation:s})),j=m.selected,h=m.onOptionSelect,w=m.onValueChange,m=m.toggleCheck,E=useSearch({search:r,multiple:i,dataSet:e}),K=E.searchData,b=E.inputValue,E=E.onInputChange,y=useExpanded({flattedData:y,defaultExpandAll:p,defaultExpandedKeys:u,expandedKeys:f,onExpand:g}),p=y.expandKeys,u=y.toggleExpand,f=useLoadData({loadData:x,toggleExpand:u}),g=f.loadingId,y=f.startLoadData,f=useAnchor({onInputChange:E}),A=f.anchorEl,S=f.inputRef,O=f.eleRef,k=f.openDropDown,P=f.hovering,I=f.setHovering,f=useTagLimits({maxTagCount:v,selected:j,inputRef:S}),R=f.tagLimit,F=f.tagWidths,L=f.setTagWidths;return _jsxs(_Fragment,{children:[_jsx(Autocomplete,{ref:O,options:[],open:!1,disabled:D.disabled,onFocus:k,readOnly:!(r&&A),multiple:i,disableClearable:!0,value:a(),inputValue:b,onClick:function(e){return e.stopPropagation()},onInputChange:E,onMouseEnter:function(e){return I(!0)},onMouseLeave:function(e){return I(!1)},popupIcon:P&&j.length&&_?_jsx(CancelIcon,{onClick:t}):_jsx(ArrowDropDownIcon,{onClick:k}),renderInput:function(e){var t=!!A;return _jsx(TextField,__assign({},e,D,{onClick:function(e){return e.stopPropagation()},focused:t,ref:S,placeholder:t&&!i?a():D.placeholder,sx:{"& .MuiAutocomplete-inputRoot":{flexWrap:"responsive"===v?"nowrap":"wrap"}}}))},renderTags:function(e,t){var a=e.slice(0,R),e=e.slice(R),o=D.size;return a.map(function(e,a){e=T.get(e);return _jsx(Tag,{size:o,onDelete:function(t){w(j.filter(function(e){return e!==t})),L(F.filter(function(e,t){return t!==a}))},option:e,onInit:function(e){var t=__spreadArray([],__read(F),!1);t[a]=e,L(t)}})}).concat(e.length?[_jsx(Chip,{size:o,label:"+".concat(e.length,"...")})]:[])}}),_jsx(DropDown,__assign({anchorEl:A,placement:o,popperStyle:c,popperClassName:d,initialWidth:null==(f=null==O?void 0:O.current)?void 0:f.offsetWidth},{children:_jsx(Options,{dense:"small"===D.size,showCheck:i&&l,multiple:i,selected:j,loadData:x,expandKeys:p,toggleExpand:u,dataSet:e,checkWithRelation:s,loadingId:g,startLoadData:y,searchData:K,onSelect:h,toggleCheck:m})}))]})};export default TreeSelect;